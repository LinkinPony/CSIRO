# Augmentation policy switch:
# - legacy: handcrafted torchvision pipeline (flip/affine/jitter/blur/noise/erasing + overlays)
# - augmix : AugMix (+ optional overlays)
policy: legacy

# Debug: dump the *final* images fed to the model (after CutMix) for quick sanity checks.
# Saved under: outputs/<version>/debug/inputs/ (unless out_dir is overridden).
debug_dump:
  enabled: false
  stages: [train]
  # Dump cadence: dump once every N global steps (optimizer steps).
  every_n_steps: 50
  # Total cap across the whole run.
  max_images: 32
  # How many images to save from each selected batch.
  num_images_per_step: 4
  # Save viewable RGB (de-normalized back from mean/std). If false, saves normalized tensors mapped to 0..1.
  denormalize: true
  # Output format: png | jpeg | webp
  format: jpeg
  # Optional format knobs:
  png_compress_level: 6
  jpeg_quality: 90
  webp_quality: 90
  # Optional override (relative paths are resolved under run_log_dir):
  # out_dir: debug/inputs

augmix:
  enabled: false
  # AugMix knobs (reference-style):
  # - severity: 1..10 (higher => stronger ops)
  # - width   : number of augmentation chains mixed
  # - depth   : chain depth; -1 => random in [1, 3]
  # - alpha   : Dirichlet/Beta concentration (mixing strength)
  severity: 2
  width: 2
  depth: -1
  alpha: 0.5
  # When true, include color/contrast/brightness/sharpness ops in addition to the base ops.
  all_ops: false
  # Consistency regularization (AugMix-style multi-view):
  consistency:
    enabled: false
    # When loss.weighting=uw, treat the *combined* consistency loss as an independent UW task.
    uw_task: true
    # Whether augmented views (aug1/aug2) also contribute to the *supervised* loss.
    supervise_aug_views: true
    # Number of augmented views in addition to clean: 1 => (clean, aug1), 2 => (clean, aug1, aug2)
    num_aug: 2
    # Weights for consistency terms added to the supervised loss.
    weight_reg3: 1.0
    weight_ratio_jsd: 1.0
    # Numeric clamp epsilon for JSD mixture log.
    eps: 1.0e-7

# RandomResizedCrop
random_resized_crop_enabled: true
random_resized_crop_scale: [0.8, 1.0]

# Jitter-crop (recommended): crop -> resize back to `data.image_size` while preserving aspect ratio.
jitter_crop:
  enabled: false
  prob: 1.0
  scale: [0.8, 1.2]
  ratio: null
  interpolation: bicubic
  center:
    enabled: true
    prob: 0.5
    max_offset_frac: [0.2, 0.1]
  random:
    enabled: true
    prob: 0.5

horizontal_flip_prob: 0.5

color_jitter:
  enabled: true
  prob: 0.8
  brightness: 0.2
  contrast: 0.2
  saturation: 0.1
  hue: 0.0

vertical_flip:
  enabled: true
  prob: 0.5

random_affine:
  enabled: true
  degrees: 5.0
  translate: [0.02, 0.02]
  scale: [0.95, 1.05]
  shear: [0.02, 0.02]
  interpolation: bilinear
  fill: 0

gaussian_blur:
  enabled: true
  kernel_size: 3
  kernel_size_range: [3, 7]
  prob: 0.5
  sigma: [0.1, 1.0]

gaussian_noise:
  enabled: true
  mean: 0.0
  std: 0.01
  prob: 0.5

watermark:
  enabled: true
  prob: 0.3
  style: random
  position: random
  position_choices: [bottom_right, bottom_left, top_right, top_left]
  position_probs: [0.7, 0.15, 0.1, 0.05]
  timestamp_prob: 0.5
  timestamp_format: "%d %m %Y %H:%M"
  margin_frac_range: [0.008, 0.05]
  font_size_frac_range: [0.04, 0.12]
  alpha_range: [128, 200]
  color_choices:
    - [255, 140, 0]
    - [255, 120, 0]
    - [255, 170, 40]
    - [255, 200, 0]
    - [255, 255, 255]
  color_jitter: 50
  render_mode: shadow
  shadow_color: [0, 0, 0]
  shadow_alpha_range: [160, 255]
  shadow_offset_frac_range: [0.03, 0.07]
  texts: []
  use_random_text: true
  random_text_length_range: [3, 20]

light_spot:
  enabled: true
  blend_mode: composite
  prob: 0.3
  radius_frac_range: [0.06, 0.18]
  alpha_range: [0.2, 0.6]
  color: [255, 255, 220]
  blur_frac: 0.5
  core_blur_frac: 0.15
  halo_enabled: false
  halo_scale_range: [1.0, 3.5]
  halo_alpha_mult_range: [0.06, 0.2]
  grid_enabled: false
  grid_rows_range: [2, 4]
  grid_cols_range: [2, 5]
  grid_spacing_mul_range: [5.0, 9.0]
  grid_jitter_frac: 0.12
  grid_cell_dropout_prob: 0.1
  grid_share_params: true

random_erasing:
  enabled: true
  p: 0.25
  scale: [0.02, 0.1]
  ratio: [0.3, 3.3]
  value: random

manifold_mixup:
  enabled: true
  prob: 1.0
  alpha: 2.0
  apply_on: tokens
  detach_pair: true
  mix_cls_token: false

cutmix:
  enabled: false
  alpha: 0.5
  use_prev_for_bsz1: true

no_augment_prob: 0.1


